<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>KAVAC: Página principal</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo-doc.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">KAVAC
   &#160;<span id="projectnumber">versión 1.0.0</span>
   </div>
   <div id="projectbrief">Sistema de Gestión Organizacional</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Buscar" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generado por Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Buscar');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">KAVAC Documentación</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><hr  />
<p> | |/ / / \ \ / / \ / ___| | ' / / _ \ \ / / _ | | <br  />
 | . \ / ___ \ V / ___ \ |___ |_|_\/_/ __/_/ _____|</p>
<h1>KAVAC | Sistema de Gestión Organizacional</h1>
<h2>Sobre la aplicación</h2>
<p>KAVAC es una aplicación para la gestión organizacional, permite registrar y controlar todos los procesos de la formulación y ejecución de presupuesto, así como toda la información relevante de operatividad. Este proyecto surge como iniciativa en la mejora de los procesos administrativos apuntando al uso de nuevas tecnologías.</p>
<p>Se encuentra desarrollado bajo patrones de diseño MVC con un esquema agradable y comprensible usando el framework <a class="el" href="db/d99/namespaceLaravel.html" title="Laravel - A PHP Framework For Web Artisans.">Laravel</a> y una documentación extensa tanto para desarrolladores o personal técnico, así como también para usuarios del sistema.</p>
<p>Provee de la mayoría de las herramientas requeridas para una correcta gestión de los recursos organizacionales y de los procesos inherentes a estos.</p>
<h2>Antecedentes</h2>
<p>Esta aplicación cuenta con funcionalidades y mejoras con respecto a otras herramientas de las cuales se tomaron en consideración algunos de sus procesos, implementando nuevos parádigmas de desarrollo acordes a las tendencias tecnológicas del momento.</p>
<p>Como antecedentes de esta aplicación se considera como precursor a <a href="http://said.cenditel.gob.ve/wiki">SAID - Sistema Administrativo Integrado Descentralizado</a>.</p>
<h2>Instalación de la aplicación</h2>
<pre class="fragment">Entorno: Desarrollo
Usaremos $ para describir los comandos que se ejecutaran con usuario regular.
Usaremos # para describir los comandos que se ejecutaran con superusuario.
</pre><p>Se requiere de un Sistema Operativo de 64 bits y la instalación de algunos paquetes para el correcto funcionamiento de la aplicación: </p><pre class="fragment">php &gt;= 7.4.x
php-gd
php-mbstring
php-xml
php-tokenizer
php-zip
php-pgsql
php-cli
php-curl
composer
zip
unzip
nodejs
postgresql
</pre><p>Para poder ejectutar la instalación es importante contar con el paquete <a href="https://getcomposer.org/">composer</a> el cual permite gestionar las distintas dependencias y/o paquetes requeridos por el sistema y una conexión externa a Internet. Cabe destacar que para mejores resultados, se debe tener instalado composer de manera global.</p>
<p>Una vez instalado composer comprobamos la correcta instalación con el siguiente comando: </p><pre class="fragment">$ composer --version
</pre><p>Por otro lado, se requiere contar con los paquetes NodeJS y NPM para gestionar los paquetes requeridos para la reactividad en la gestión de datos de algunos procesos.</p>
<p>Se recomienda seguir la documentación disponible desde: <a href="https://linuxconfig.org/how-to-install-node-js-on-ubuntu-16-04-xenial-xerus-linux-server">https://linuxconfig.org/how-to-install-node-js-on-ubuntu-16-04-xenial-xerus-linux-server</a> pero para este manual recomendamos los siguientes pasos:</p>
<p>Procedimiento de instalación mediante el script nativo de node <b>nvm</b> el cual permite más control en cuanto a la versión de <b>node</b> y <b>npm</b> a ser instalada.</p>
<p>Instalar los prerequisitos del S.O. mediante el siguiente comando: </p><pre class="fragment">$ sudo apt install build-essential libssl-dev
</pre><p>Descargar el script de instalación más reciente mediante <b>curl</b>, para ello se requiere ejecutar el comando: </p><pre class="fragment">$ sudo curl -o- https://raw.githubusercontent.com/creationix/nvm/{version}/install.sh | bash
</pre><p>Se debe sustituir la número de versión con la más reciente publicada la cual se puede encontrar <a href="https://github.com/nvm-sh/nvm/releases">aquí</a>, ejemplo: </p><pre class="fragment">$ sudo curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.34.0/install.sh | bash
</pre><p>Lo siguiente es configurar el acceso del nuevo script <b>NVM</b> con el siguiente comando: </p><pre class="fragment">$ . ~/.profile
</pre><p>Esto permitira acceder al comando nvm desde cualquier ruta, una vez realizada la configuración, se procederá a verificar el listado de versiones de <b>node</b> disponibles en el repositorio para lo cual se require ejecutar el comando: </p><pre class="fragment">$ nvm ls-remote | grep -i lts
</pre><p>Esto debe mostrar un listado de versiones de node que correspondan a las versiones <b>LTS</b>, ejemplo:</p>
<p>v10.15.3 (LTS: Dubnium) v10.16.0 (LTS: Dubnium) v10.16.1 (LTS: Dubnium) v10.16.2 (LTS: Dubnium) v10.16.3 (Latest LTS: Dubnium)</p>
<p>Ahora procedemos a la instalación de la versión de node más actualizada que presente la lista, para lo cual se ejecutará el comando: </p><pre class="fragment">$ nvm install 10.16.3
</pre><p>Una vez instalado NodeJS comprobamos la correcta instalación con el siguiente comando: </p><pre class="fragment">$ node -v
</pre><p>Los comandos anteriores nos instalaran NodeJS y también npm, por lo cual comprobamos su correcta instalación con el siguiente comando: </p><pre class="fragment">$ npm -v
</pre><p>Ahora se deben instalar las dependencias de php de la aplicación, por lo cual los siguientes comando se deben ejecutar dentro del directorio base de la aplicación: </p><pre class="fragment">$ composer install
</pre><p>Una vez instaladas las dependencias, ejecuta el comando: </p><pre class="fragment">$ php artisan key:generate
</pre><p>Esto generará un identificador único para la aplicación y creará (si no existe), el archivo de configuración .env, en caso de que no se genere dicho archivo se debe ejecutar el comando: </p><pre class="fragment">$ cp .env.example .env
</pre><p>Luego se debe repetir el paso anterior.</p>
<p>Luego, en el archivo .env, localizado en la raíz del sistema, se deben establecer los parámetros de configuración necesarios bajo los cuales se ejecutará la aplicación. </p><pre class="fragment">APP_NAME
APP_ENV
APP_KEY
APP_DEBUG
APP_LOG_LEVEL
APP_URL
APP_DEMO
APP_TESTING
APP_TESTING_URL

AUDIT_LIMIT

LOG_CHANNEL
LOG_SLACK_WEBHOOK_URL

DB_CONNECTION
DB_HOST
DB_PORT
DB_DATABASE
DB_USERNAME
DB_PASSWORD

BROADCAST_DRIVER
CACHE_DRIVER
SESSION_DRIVER
SESSION_LIFETIME
QUEUE_CONNECTION

REDIS_HOST
REDIS_PASSWORD
REDIS_PORT
REDIS_CLIENT
REDIS_DB

MAIL_DRIVER
MAIL_HOST
MAIL_PORT
MAIL_USERNAME
MAIL_PASSWORD
MAIL_ENCRYPTION

AWS_ACCESS_KEY_ID
AWS_SECRET_ACCESS_KEY
AWS_DEFAULT_REGION
AWS_BUCKET

PUSHER_APP_ID
PUSHER_APP_KEY
PUSHER_APP_SECRET
PUSHER_APP_CLUSTER
PUSHER_APP_TLS

WEBSOCKETS_HOST
WEBSOCKETS_PORT
WEBSOCKETS_SSL_LOCAL_CERT
WEBSOCKETS_SSL_LOCAL_PK
WEBSOCKETS_SSL_PASSPHRASE

MIX_APP_URL
MIX_APP_ROOT
MIX_PUSHER_APP_KEY
MIX_PUSHER_APP_CLUSTER
MIX_WEBSOCKETS_HOST
MIX_WEBSOCKETS_PORT
MIX_PUSHER_APP_TLS
</pre><p>De igual manera se debe instalar los paquetes necesarios para la gestión reactiva de datos, para lo cual se debe ejecutar el siguiente comando (teniendo en cuenta que se debe contar con nodejs y npm previamente instalados): </p><pre class="fragment">$ npm install
</pre><p>El comando anterior instala todas las dependencias de node requeridas por el sistema.</p>
<h2>Configuración de variables</h2>
<p>Dentro del archivo **.env** se encuentran algunas variables que deben ser configuradas previamente para el correcto funcionamiento de la aplicación las cuales se describen a continuación:</p>
<p>APP_NAME | Esta variable almacena el nombre de la aplicación cuyo valor por defecto es KAVAC.</p>
<p>APP_ENV | Establece el entorno bajo el cual se ejecuta la aplicación. Para un entorno en producción se debe establecer el valor a <b>production</b>.</p>
<p>APP_KEY | El valor de esta variable se establece al ejecutar el comando php artisan key:generate.</p>
<p>APP_DEBUG | Establece si la aplicación se ejecuta en modo de desarrollo si el valor es establecido en <b>true</b>, mostrando detalles de los eventos que se generan en la aplicación así como la barra de de desarrollo <b>debugbar</b>. Para entornos en producción esta variable debe establecerse en <b>false</b>.</p>
<p>APP_LOG_LEVEL | Indica el nivel de detalle para el cual se genera la bitácora de eventos y su valor por defecto es <b>debug</b> el cual establece el nivel de detalle mas amplio.</p>
<p>APP_URL | El valor establecido en esta variable es de importancia en otros procesos del sistema y en ella se indica el <b>dominio</b> o <b>IP</b> de la aplicación incluyendo el protocolo <b>http</b> o <b>https</b>.</p>
<p>APP_DEMO | El valor de esta variable determina si la aplicación se esta ejecutando en modo de demostración cuando es establecida como <b>true</b>, su valor por defecto es <b>false</b>.</p>
<p>APP_TESTING | Indica si la aplicación se encuentra en mnodo de prueba para lo cual se debe establecer el valor en <b>true</b>. Su valor por defecto es <b>false</b>.</p>
<p>APP_TESTING_URL | Establece el <b>dominio</b> o <b>IP</b> de la aplicación para pruebas incluyendo el protocolo <b>http</b> o <b>https</b>, esta variable es opcional.</p>
<p>AUDIT_LIMIT | Indica el límite de registros a almacenar por cada modelo de la aplicación para la auditoria.</p>
<h2>Notificaciones por correo</h2>
<p>Para el correcto funcionamiento de las notificaciones del sistema mediante la gestión de correo electrónico, se deben establecer los valores necesarios del servidor de correo a utilizar por la aplicación. Estas variables son: </p><pre class="fragment">MAIL_DRIVER
MAIL_HOST
MAIL_PORT
MAIL_USERNAME
MAIL_PASSWORD
MAIL_ENCRYPTION
</pre><p>Donde,</p>
<p>MAIL_DRIVER | Es el driver de conexión al servidor de correo saliente que gestionará las notificaciones.</p>
<p>MAIL_HOST | Es el dominio del host de correo saliente.</p>
<p>MAIL_PORT | Es el puerto del servidor de correo saliente.</p>
<p>MAIL_USERNAME | Es el nombre del usuario con atributos para enviar correo electrónico.</p>
<p>MAIL_PASSWORD | Es la contraseña del usuario que gestiona el correo saliente.</p>
<p>MAIL_ENCRYPTION | Define el protocolo de cifrado usado por el gestor de correo electrónico. Los valores a establecer pueden ser: <b>ssl</b>, <b>tls</b> o <b>null</b>.</p>
<h2>Compilar archivos js y css de cada modulo de la aplicación:</h2>
<pre class="fragment">$ php artisan module:compile -s -i -p
</pre><h2>Base de datos</h2>
<p>KAVAC puede ser ejecutado con diferentes gestores de Base de datos tales como PostgreSQL, MySQL, SQLite, entre otros, sin embargo se recomienda el uso del gestor de Base de datos PostgreSQL por su capacidad en la gestión de información.</p>
<p>Debe crear una base de datos en el gestor de su preferencia y configurarlo en el archivo .env con los datos de acceso.</p>
<p>Ejemplo de configuración de una base de datos de PostgreSQL: </p><pre class="fragment">DB_CONNECTION=pgsql
DB_HOST=localhost
DB_PORT=5432
DB_DATABASE=kavac
DB_USERNAME=kavac
DB_PASSWORD=kavac
</pre><p>Una vez configurado el gestor de base de datos, se deben ejecutar los siguientes comandos: </p><pre class="fragment">$ php artisan migrate
</pre><p>Lo anterior creará la estructura de tablas de la base de datos necesaria para comenzar a gestionar la información.</p>
<h2>Registros iniciales</h2>
<p>KAVAC, cuenta con información inicial requerida para la gestión de la aplicación, para lo cual se debe ejecutar el comando: </p><pre class="fragment">$ php artisan db:seed
</pre><p>El anterior comando ejecutara las acciones necesarias para ingresar al sistema los datos inicialmente requeridos por la aplicación base como son: usuario, roles, permisos, localidades, estados civiles, profesiones, sectores de organizaciones y tipos de organizaciones.</p>
<p>La aplicación cuenta con una cantidad de módulos independientes que permiten expandir sus funcionalidades, cada uno de estos módulos cuentan con sus registros iniciales por lo que es necesario ejecutar un comando adicional que permita registrar información de cada módulo instalado y habilitado en el sistema, para ello se ejecuta el siguiente comando: </p><pre class="fragment">$ php artisan module:seed
</pre><p>Esto revisará que módulos del sistema estan habilitados y procederá a registrar la información requerida, inicialmente, por cada uno de ellos.</p>
<p>Una vez que hayan sido registrado los datos iniciales del sistema, se puede autenticar en el mismo con los siguientes datos de acceso como administrador (es recomendable modificar la contraseña en el primer acceso al sistema): </p><pre class="fragment">usuario: admin
clave: 123456
</pre><p>El primer paso, para el correcto funcionamiento del sistema, es registrar información básica de la organización que llevará a cabo la gestión de información dentro de la aplicación, para ello se debe ingresar al menú </p><pre class="fragment">Configuración &gt; General
</pre><p>Y allí, en el panel **"CONFIGURAR ORGANIZACIÓN"** se deben indicar los datos de la organización. Una vez configurada, se mostrarán todas las opciones de los módulos disponibles en el sistema.</p>
<h2>Probar la aplicación</h2>
<p>Para identificar si la aplicación se encuentra correctamente instalada, puedes ejecutar el comando de artisan que te permite levantar un servidor en entornos de desarrollo de la siguiente forma: </p><pre class="fragment">$ php artisan serve
</pre><p>Este comando levanta un servidor en la dirección ip 127.0.0.1 o localhost y en el puerto 8000, para verificarlo puedes acceder a el enlace <a href="127.0.0.1:8000">127.0.0.1:8000</a></p>
<p>Puedes, de igual forma asignarle una dirección IP o dominio a este comando y un puerto en donde atenderá las peticiones para lo cual se puede agregar las opciones &ndash;host y/o &ndash;port, un ejemplo de su uso sería: </p><pre class="fragment">$ php artisan serve --port 192.168.1.1 --port 9000
</pre><p>Llegado a este punto ya se debe contar con la aplicación funcional en un entorno local de desarrollo, a continuación se describen configuraciones para entornos de producción.</p>
<h2>Configuración extra para entornos de producción</h2>
<pre class="fragment">Entorno: Producción
Usaremos $ para describir los comandos que se ejecutaran con usuario regular.
Usaremos # para describir los comandos que se ejecutaran con superusuario.
</pre><p>Se requiere la instalación de algunos paquetes para el correcto funcionamiento de la aplicación: </p><pre class="fragment">servidor de aplicaciones nginx, apache, etc
supervisor
</pre><h2>Glosario</h2>
<p>**(ruta-absoluta-de-instalacion)**: Es la ruta en donde se va a instalar la aplicación, colocando la misma sin los (), por ejemplo: </p><pre class="fragment">/srv/kavac/
</pre><p>**(version-php-instalada)**: Es la versión del o los paquetes de PHP instalados, colocando la misma sin los (), por ejemplo: 7.4</p>
<h2>Configuración del servidor de aplicaciones</h2>
<p>En esta documentación se explica como configurar un servidor de aplicaciones Nginx (para otro tipo de servidor se debe consultar la documentación pertinente para una configuración óptima en aplicaciones basadas en PHP).</p>
<h3>Instalar Nginx</h3>
<p>Lo primero que se debe realizar es la instalación del servidor de aplicaciones con el comando </p><pre class="fragment"># apt install nginx
</pre><p>Una vez completada la instalación, inicie el servicio nginx y agréguelo para que se inicie automáticamente con sistema operativo mediante el comando systemctl. </p><pre class="fragment"># systemctl start nginx
# systemctl enable nginx
</pre><p>El servidor Nginx se ejecutará en el puerto 80, para verificar si se ejecutó correctamente debe ejecutar el comando </p><pre class="fragment"># netstat -plntu
</pre><p>Si todo lo muestra correctamente, nginx estará instalado y en ejecución.</p>
<h3>Instalar PHP-FPM</h3>
<p>Para instalar la extensión FPM (FastCGI Process Manager) de la versión de PHP instalada en el sistema operativo se debe ejecutar el comando </p><pre class="fragment"># apt install php-fpm
</pre><p>El próximo paso es configurar el archivo php.ini de FPM, para lo cual se deve acceder a la ruta en donde fue instalado, por lo general esta ruta se encuentra en /etc/php/(version-php-instalada)/fpm/, para esto se debe editar ejecutando </p><pre class="fragment"># nano /etc/php/(version-php-instalada)/fpm/php.ini
</pre><p>donde (version-php-instalada) es la versión de php instalada en el servidor, Ej. 7.3</p>
<p>la subcarpeta **/fpm/** puede variar de acuerdo a la distribución linux utilizada por lo que puede estar presente o no.</p>
<p>En el contenido del archivo se debe buscar y descomentar la variable cgi.fix_pathinfo=1 y cambiar el valor a 0 </p><pre class="fragment">cgi.fix_pathinfo=0
</pre><p>A su vez, se deben realizar algunos ajustes adicionales para optimizar las peticiones para la carga d archivos por lo que es necesario establecer los siguientes valores a las variables descritas: </p><pre class="fragment">upload_max_filesize = 10M

max_file_uploads = 50

post_max_size = 40M
</pre><p>Guarda las modificaciones realizadas e inicializa el servicio FPM con los comandos </p><pre class="fragment"># systemctl start php(version-php-instalada)-fpm

# systemctl enable php(version-php-instalada)-fpm
</pre><p>El primer comando inicializa el servicio y el segundo lo habilita para que se ejecute automáticamente al arrancar el servidor.</p>
<p>Por defecto en sistemas operativos como Ubuntu el servicio PHP-FPM se ejecuta bajo un archivo socket, para verificar que el servicio PHP-FPM se haya inicializado correctamente deberá escribir el comando netstat de la siguiente forma </p><pre class="fragment">$ netstat -pl | grep php(version-php-instalada)-fpm
</pre><p>Con lo anterior, el servidor virtual para la aplicación fue creado, solo queda reiniciar el servidor nginx para que las modificaciones tengan efecto </p><pre class="fragment"># systemctl restart nginx
</pre><h3>Configurar el servidor virtual de Nginx</h3>
<p>Para que la aplicación se ejecute en el servidor de aplicaciones Nginx, se debe realizar una configuración adicional creando para ello un archivo que contendrá dicha configuración, para esto se ejecutara el siguiente comando </p><pre class="fragment"># nano /etc/nginx/sites-available/kavac
</pre><p>y se agregara el siguiente contenido: </p><pre class="fragment">server {
    proxy_busy_buffers_size   256k;
    proxy_buffers   4 256k;
    proxy_buffer_size   128k;
    fastcgi_buffers 16 16k;
    fastcgi_buffer_size 32k;
    fastcgi_busy_buffers_size 32k;

    listen 80;
    # Descomentar si las peticiones solo aceptan el protocolo ipv6
    # listen [::]:80 ipv6only=on;

    # Log files for Debugging
    access_log /var/log/nginx/kavac-access.log;
    error_log /var/log/nginx/kavac-error.log;

    # Webroot Directory for kavac project
    root (ruta-absoluta-de-instalacion)/public;
    index index.php index.html index.htm;

    # Your Domain Name
    server_name (nombre-de-dominio-que-atiende-las-peticiones);

    location / {
        try_files $uri $uri/ /index.php?$query_string;
    }

    # PHP-FPM Configuration Nginx
    location ~ \.php$ {
        try_files $uri =404;
        fastcgi_split_path_info ^(.+\.php)(/.+)$;
        fastcgi_pass unix:/run/php/php(version-php-instalada)-fpm.sock;
        fastcgi_index index.php;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        include fastcgi_params;
    }
}
</pre><p>guarda las modificaciones y cierra el archivo</p>
<p>Ahora para activar el servidor virtual se debe crear un enlace símbolico al archivo de configuración de la siguiente forma </p><pre class="fragment"># ln -s /etc/nginx/sites-available/kavac /etc/nginx/sites-enabled/
</pre><p>Para que estos cambios tengan efecto se debe reiniciar el servidor de aplicaciones </p><pre class="fragment"># systemctl restart nginx
</pre><h2>Procesamiento de colas</h2>
<p>El sistema cuenta con procedimientos que permiten establecer colas de trabajo para peticiones y registros con grandes cantidades de información, por tal motivo es necesario realizar una configuración previa antes de iniciar la aplicación.</p>
<p>Dentro del archivo <a class="el" href="d5/d4e/queue_8php_source.html">config/queue.php</a> se encuentra las distintas variables a configurar para el uso de colas, por lo que se deben configurar el driver a usar para la gestión de las colas y posteriormente configurar los datos necesarios del servidor seleccionado.</p>
<p>Lo primero es configuar dentro del archivo de entorno (.env) la variable <b>QUEUE_CONNECTION</b> para el uso del driver a implementar en la gestión de colas, por defecto esta configurado para hacer uso del driver mediante base de datos de la siguiente manera: </p><pre class="fragment">QUEUE_CONNECTION=database
</pre><p>Si se desea configurar otro driver para la gestión de colas se puede obtener información en la documentación oficial del framework <a href="https://docs.laravel.com">Laravel</a>.</p>
<p>Una vez configurado el servidor de colas es necesario realizar los procedimientos necesarios para que los <b>workers</b> que procesan las colas de trabajo esten activo en todo momento, para esto es recomendable configurar a supervisorctl de la siguiente forma:</p>
<p>Crear un archivo llamado <b>kavac-worker.conf</b> en la ruta **/etc/supervisor/conf.d/** con el siguiente contenido: </p><pre class="fragment">[program:laravel-worker]
process_name=%(program_name)s_%(process_num)02d
command=/usr/bin/php &lt;ruta-de-la-aplicacion-kavac&gt;/artisan queue:work sqs --sleep=3 --tries=3
autostart=true
autorestart=true
user=&lt;usuario-del-sistema&gt;
numprocs=1
redirect_stderr=true
stdout_logfile=&lt;ruta-de-la-aplicacion-kavac&gt;/storage/logs/worker.log
stopwaitsecs=3600
</pre><p>Donde: </p><pre class="fragment">/user/bin/php es la ruta en donde se encuentra el comando php.

&lt;ruta-de-la-aplicacion-kavac&gt; es la ruta en donde se encuentra instalada la aplicación.

&lt;usuario-del-sistema&gt; es el usuario del sistema operativo en donde se encuentra la aplicación, el cual tendrá los permisos necesarios para ejecutar los distintos procesos.
</pre><p>Actualizar y ejecutar supervisorctl de la siguiente forma: </p><pre class="fragment">$ sudo supervisorctl reread

$ sudo supervisorctl update

$ sudo supervisorctl start kavac-worker:*
</pre><h2>Websockets</h2>
<p>La aplicación viene con un sistema de notificaciones en tiempo real con websockets por lo que es necesario iniciar y mantener el servidor que atiende y despacha estas peticiones, además de establecer algunos valores en el archivo **.env** de la siguiente forma: </p><pre class="fragment">PUSHER_APP_ID=&lt;API_ID&gt;
PUSHER_APP_KEY=&lt;API_KEY&gt;
PUSHER_APP_SECRET=&lt;API_SECRET&gt;
PUSHER_APP_CLUSTER=mt1
PUSHER_APP_TLS=false

WEBSOCKETS_HOST=&lt;WEBSOCKET_IP&gt;
WEBSOCKETS_PORT=&lt;WEBSOCKET_PORT&gt;
WEBSOCKETS_SSL_LOCAL_CERT=null
WEBSOCKETS_SSL_LOCAL_PK=null
WEBSOCKETS_SSL_PASSPHRASE=null

MIX_APP_URL="${APP_URL}"
MIX_APP_ROOT="${APP_ROOT}"
MIX_PUSHER_APP_KEY="${PUSHER_APP_KEY}"
MIX_PUSHER_APP_CLUSTER="${PUSHER_APP_CLUSTER}"
MIX_WEBSOCKETS_HOST="${WEBSOCKETS_HOST}"
MIX_WEBSOCKETS_PORT="${WEBSOCKETS_PORT}"
MIX_PUSHER_APP_TLS="${PUSHER_APP_TLS}"
</pre><p>Luego de realizada la configuración en el archivo de entorno **.env** se requiere tener instalado en el servidor de aplicaciones una aplicación que monitoree y ejecute este servicio para lo cual se utiliza la aplicación <em><b>supervisor</b></em>.</p>
<p>Una vez instalado <em><b>supervisor</b></em>, se requiere agregar y configurar un nuevo proceso que permita mantener la ejecución de los websockets de la aplicación, para lo cual se debe crear un nuevo archivo con el nombre <b>websockets.conf</b> dentro del directorio /etc/supervisor/conf.d (en Debian/Ubuntu) ó /etc/supervisord.d (en RedHat/CentOS).</p>
<p>El archivo creado deberá contener la siguiente información: </p><pre class="fragment">[program:websockets]
command=/usr/bin/php &lt;ruta-de-la-aplicacion-kavac&gt;/artisan websockets:serve
numprocs=1
autostart=true
autorestart=true
user=&lt;usuario-del-sistema&gt;
</pre><p>Donde: </p><pre class="fragment">/user/bin/php es la ruta en donde se encuentra el comando php

&lt;ruta-de-la-aplicacion-kavac&gt; es la ruta en donde se encuentra instalada la aplicación

&lt;usuario-del-sistema&gt; es el usuario del sistema operativo en donde se encuentra la aplicación, el cual tendrá los permisos necesarios para ejecutar los distintos procesos
</pre><p>Con la configuración anteriormente descrita, se debe reiniciar el <b>supervisor</b> para que tome en cuenta la nueva configuración, para lo cual se ejecutan los siguientes comandos: </p><pre class="fragment">$ supervisorctl update

$ supervisorctl start websockets
</pre><p>Para verificar que la configuración es correcta y el servicio se este ejecutando, se puede indicar el siguiente comando: </p><pre class="fragment">$ supervisorctl status
</pre><p>El último paso en el proceso de instalación es modificar los usuarios y permisos para el acceso del servidor a la aplicación KAVAC, para lo cual le indicamos la permisología y usuario correspondiente </p><pre class="fragment"># chown -R www-data:root (ruta-absoluta-de-instalacion)

# chmod 755 (ruta-absoluta-de-instalacion)/storage
</pre><h2><a class="el" href="db/d99/namespaceLaravel.html" title="Laravel - A PHP Framework For Web Artisans.">Laravel</a> ER Diagram Generator</h2>
<p>Este paquete permite generar diagramas de entidad relación inspeccionando las relaciones definidas en sus archivos de modelo. Por defecto busca los modelos en la carpeta app. Para agregar los modelos que se encuentran en cada módulo hay que hacer lo siguiente: </p><pre class="fragment">// Editar en el archivo
vendor/beyondcode/laravel-er-diagram-generator/config/config.php

// Esta sección en la linea 9
'directories' =[
    base_path('app'),
    // Carpeta agregada para el módulo Payroll
    base_path('modules/Payroll/Models'),
],
</pre><p>En ese ejemplo genera el diagrama del sistema base y del módulo Talento Humano.</p>
<p>Comando para generar el diagrama: </p><pre class="fragment">$ php artisan generate:erd kavac.svg --format=svg
</pre><p>Para un mejor rendimiento de la aplicación en entornos de producción se recomienda utilizar el comando: </p><pre class="fragment">$ composer install --optimize-autoloader --no-dev
</pre><p>Esto permitirá una carga más optimizada de los componentes del sistema.</p>
<h2>Probar la aplicación</h2>
<p>Para identificar si la aplicación se encuentra correctamente instalada, puedes ejecutar el comando de artisan que te permite levantar un servidor en entornos de desarrollo de la siguiente forma: </p><pre class="fragment">$ php artisan serve
</pre><p>Este comando levanta un servidor en la dirección ip 127.0.0.1 o localhost y en el puerto 8000, para verificarlo puedes acceder a el enlace <a href="127.0.0.1:8000">127.0.0.1:8000</a></p>
<p>Puedes, de igual forma asignarle una dirección IP o dominio a este comando y un puerto en donde atenderá las peticiones para lo cual se puede agregar las opciones &ndash;host y/o &ndash;port, un ejemplo de su uso sería: </p><pre class="fragment">$ php artisan serve --port 192.168.1.1 --port 9000
</pre><h2>Comandos básicos laravel-modules</h2>
<p>Ejecutar las migraciones laravel-modules </p><pre class="fragment">$ php artisan module:migrate
</pre><p>Crea un nuevo modelo para el módulo especificado junto con su migración </p><pre class="fragment">$ php artisan module:make-model -m ModuleNameModelName ModuleName
</pre><p>Genera nuevo controlador restful para el módulo especificado </p><pre class="fragment">$ php artisan module:make-controller ModuleNameModelName ModuleName
</pre><p>Genera nuevo seeder para el módulo especificado (nombre del modelo en plural) </p><pre class="fragment">$ php artisan module:make-seed ModuleNameModelName ModuleName
</pre><h2>Documentación</h2>
<p>La aplicación cuenta con una amplia documentación técnica y para usuarios del sistema, las cuales se encuentran bajo las siguientes rutas:</p>
<ul>
<li>[Técnica]()</li>
<li>[Usuario]()</li>
</ul>
<h2>Licencia</h2>
<p>Kavac es una aplicación de código abierto y se distribuye estrictamente bajo la licencia <a href="http://conocimientolibre.cenditel.gob.ve/licencia-de-software-v-1-3/">LICENCIA DE SOFTWARE CENDITEL</a>. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generado el Miércoles, 8 de Diciembre de 2021 14:40:04 para KAVAC por
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
